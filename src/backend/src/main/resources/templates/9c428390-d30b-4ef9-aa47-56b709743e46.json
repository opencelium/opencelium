{"templateId":"9c428390-d30b-4ef9-aa47-56b709743e46","name":"Create nodes and deploy. v5","description":"","license":null,"connection":{"title":"OpenNMS create nodes","description":"","fromConnector":{"connectorId":2,"invoker":{"name":"i-doit","links":[]},"methods":[{"nodeId":null,"index":"0","name":"cmdb.objects.read","color":"#FFCFB5","request":{"nodeId":null,"endpoint":"{url}","method":"POST","header":null,"body":{"method":"cmdb.objects.read","id":"1","params":{"filter":{"sys_id":"","firstname":"","ids":[],"type_title":"","type":["59"],"title":"","email":"","lastname":""},"apikey":"{apikey}","limit":"","order_by":"","language":"","sort":""},"version":"2.0"},"links":[]},"response":{"nodeId":null,"name":"response","success":{"nodeId":null,"status":"200","header":null,"body":{"result":[{"cmdb_status_title":"","image":"","sysid":"","created":"","type_title":"","cmdb_status":"","id":"","title":"","type":"","updated":"","status":"","type_group_title":""}],"id":"","jsonrpc":""},"links":[]},"fail":{"nodeId":null,"status":"200","header":null,"body":{"error":{"code":"","data":"","message":""}},"links":[]},"links":[]},"links":[]},{"nodeId":null,"index":"1_0","name":"cmdb.category.read","color":"#C77E7E","request":{"nodeId":null,"endpoint":"{url}","method":"POST","header":null,"body":{"method":"cmdb.category.read","id":"1","params":{"apikey":"{apikey}","objID":"#FFCFB5.(response).success.result[].id","language":"","category":"C__CATG__IP"},"version":"2.0"},"links":[]},"response":{"nodeId":null,"name":"response","success":{"nodeId":null,"status":"200","header":null,"body":{"result":[{"hostname":"","objID":"","id":""}]},"links":[]},"fail":{"nodeId":null,"status":"200","header":null,"body":{"error":{"code":"","data":"","message":""}},"links":[]},"links":[]},"links":[]}],"operators":[{"nodeId":null,"type":"loop","index":"1","condition":{"relationalOperator":"","leftStatement":{"color":"#FFCFB5","field":"success.result[]","type":"response","rightPropertyValue":"","links":[]},"rightStatement":null,"links":[]},"links":[]}],"links":[]},"toConnector":{"connectorId":8,"invoker":{"name":"openNMS","links":[]},"methods":[{"nodeId":null,"index":"0_0","name":"createRequisition","color":"#6477AB","request":{"nodeId":null,"endpoint":"{url}/rest/requisitions","method":"POST","header":null,"body":{"node":[],"foreign-source":"#FFCFB5.(response).success.result[].title"},"links":[]},"response":{"nodeId":null,"name":"response","success":{"nodeId":null,"status":"200","header":null,"body":null,"links":[]},"fail":{"nodeId":null,"status":"400","header":null,"body":null,"links":[]},"links":[]},"links":[]},{"nodeId":null,"index":"0_1","name":"createNode","color":"#98BEC7","request":{"nodeId":null,"endpoint":"{url}/rest/requisitions/{%#FFCFB5.(response).success.result[].title%}/nodes","method":"POST","header":null,"body":{"foreign-id":"#C77E7E.(response).success.result[].id","node-label":"#C77E7E.(response).success.result[].hostname","parent-node-label":"","parent-foreign-id":"","meta-data":[],"interface":"#C77E7E.(response).success.result[]","category":[{"name":"Servers"}],"asset":[]},"links":[]},"response":{"nodeId":null,"name":"response","success":{"nodeId":null,"status":"200","header":null,"body":null,"links":[]},"fail":{"nodeId":null,"status":"400","header":null,"body":null,"links":[]},"links":[]},"links":[]},{"nodeId":null,"index":"0_2","name":"rescanExisting","color":"#9EC798","request":{"nodeId":null,"endpoint":"{url}/rest/requisitions/{%#FFCFB5.(response).success.result[].title%}/import?rescanExisting=true","method":"PUT","header":{"Authorization":"{token}","Accept":"application/json","Content-Type":"application/json"},"body":{"rescanExisting":true},"links":[]},"response":{"nodeId":null,"name":"response","success":{"nodeId":null,"status":"200","header":null,"body":null,"links":[]},"fail":{"nodeId":null,"status":"400","header":null,"body":null,"links":[]},"links":[]},"links":[]}],"operators":[{"nodeId":null,"type":"loop","index":"0","condition":{"relationalOperator":"","leftStatement":{"color":"#FFCFB5","field":"success.result[]","type":"response","rightPropertyValue":"","links":[]},"rightStatement":null,"links":[]},"links":[]}],"links":[]},"fieldBinding":[{"from":[{"color":"#FFCFB5","type":"response","field":"success.result[].title","links":[]}],"enhancement":{"enhanceId":null,"name":"","description":"","expertCode":"RESULT_VAR = VAR_0;","expertVar":"//var RESULT_VAR = #6477AB.(request).foreign-source;\n//var VAR_0 = #FFCFB5.(response).success.result[].title;","simpleCode":null,"language":"js","links":[]},"to":[{"color":"#6477AB","type":"request","field":"foreign-source","links":[]}],"links":[]},{"from":[{"color":"#C77E7E","type":"response","field":"success.result[]","links":[]}],"enhancement":{"enhanceId":null,"name":"","description":"","expertCode":"var ip = '0.0.0.0';\nif(VAR_0[0] && VAR_0[0].primary_hostaddress && VAR_0[0].primary_hostaddress.ref_title){\n  ip = VAR_0[0].primary_hostaddress.ref_title;\n}\nRESULT_VAR = [{\n  \"ip-addr\": ip,\n\t\"snmp-primary\": \"P\",\n\t\"status\": 1,\n\t\"meta-data\": [],\n\t\"monitored-service\": []\n}];","expertVar":"//var RESULT_VAR = #98BEC7.(request).interface[];\n//var VAR_0 = #C77E7E.(response).success.result[];","simpleCode":null,"language":"js","links":[]},"to":[{"color":"#98BEC7","type":"request","field":"interface[]","links":[]}],"links":[]},{"from":[{"color":"#C77E7E","type":"response","field":"success.result[].id","links":[]}],"enhancement":{"enhanceId":null,"name":"","description":"","expertCode":"RESULT_VAR = VAR_0[0];","expertVar":"//var RESULT_VAR = #98BEC7.(request).foreign-id;\n//var VAR_0 = #C77E7E.(response).success.result[].id;","simpleCode":null,"language":"js","links":[]},"to":[{"color":"#98BEC7","type":"request","field":"foreign-id","links":[]}],"links":[]},{"from":[{"color":"#C77E7E","type":"response","field":"success.result[].hostname","links":[]}],"enhancement":{"enhanceId":null,"name":"","description":"","expertCode":"RESULT_VAR = VAR_0[0];","expertVar":"//var RESULT_VAR = #98BEC7.(request).node-label;\n//var VAR_0 = #C77E7E.(response).success.result[].hostname;","simpleCode":null,"language":"js","links":[]},"to":[{"color":"#98BEC7","type":"request","field":"node-label","links":[]}],"links":[]}],"links":[]}}